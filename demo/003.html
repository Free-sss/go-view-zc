<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECharts自定义SVG图例背景</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 300;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .chart-container {
      height: 500px;
      margin-bottom: 30px;
    }

    .code-container {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      font-family: 'Fira Code', monospace;
    }

    .legend-guide {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .legend-svg {
      width: 40px;
      height: 40px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ECharts 5.6.0 - 自定义SVG图例背景</h1>

    <div class="chart-container" id="chart"></div>

    <div class="code-container">
      <h3>实现要点：</h3>
      <ul>
        <li>使用legend.formatter自定义图例内容</li>
        <li>通过rich配置实现SVG背景和文字叠加</li>
        <li>使用CSS样式确保文字精确居中</li>
        <li>通过legend.itemWidth和legend.itemHeight控制尺寸</li>
      </ul>
    </div>

    <div class="legend-guide">
      <div class="legend-item">
        <svg class="legend-svg" viewBox="0 0 40 40">
          <circle cx="20" cy="20" r="18" fill="#5470c6" opacity="0.3" />
          <circle cx="20" cy="20" r="15" fill="none" stroke="#5470c6" stroke-width="2" />
        </svg>
        <span>产品A - 圆形SVG</span>
      </div>
      <div class="legend-item">
        <svg class="legend-svg" viewBox="0 0 40 40">
          <rect x="5" y="5" width="30" height="30" fill="#91cc75" opacity="0.3" />
          <rect x="8" y="8" width="24" height="24" fill="none" stroke="#91cc75" stroke-width="2" />
        </svg>
        <span>产品B - 方形SVG</span>
      </div>
      <div class="legend-item">
        <svg class="legend-svg" viewBox="0 0 40 40">
          <polygon points="20,5 35,35 5,35" fill="#fac858" opacity="0.3" />
          <polygon points="20,10 30,30 10,30" fill="none" stroke="#fac858" stroke-width="2" />
        </svg>
        <span>产品C - 三角形SVG</span>
      </div>
    </div>
  </div>

  <script>
    // 初始化ECharts实例
    const chartDom = document.getElementById('chart');
    const myChart = echarts.init(chartDom);

    // 配置项
    const option = {
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: {
        data: ['产品A', '产品B', '产品C'],
        top: 20,
        formatter: function (name) {
          // 为每个图例项返回富文本内容
          const iconSvg = {
            '产品A': 'path://M20,2 A18,18 0 1,1 20,38 A18,18 0 1,1 20,2 Z M20,7 A13,13 0 1,0 20,33 A13,13 0 1,0 20,7 Z',
            '产品B': 'path://M5,5 L35,5 L35,35 L5,35 Z M8,8 L32,8 L32,32 L8,32 Z',
            '产品C': 'path://M20,5 L35,35 L5,35 Z M20,10 L30,30 L10,30 Z'
          };

          // 返回富文本字符串
          return `{l|${name}}`;
        },
        textStyle: {
          rich: {
            l: {
              backgroundColor: 'rgba(0,0,0,0)', // 透明背景
              height: 40,
              width: 40,
              align: 'center',
              verticalAlign: 'middle',
              padding: [0, 0, 0, 0],
              // 使用before伪元素添加SVG背景
              // 注意：ECharts富文本不支持直接使用::before，所以使用背景图片替代
            }
          }
        },
        itemGap: 30,
        itemWidth: 40,
        itemHeight: 40
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        top: '80px',
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']
      },
      yAxis: {
        type: 'value',
        name: '销售额 (万元)',
        axisLabel: {
          formatter: '{value}'
        }
      },
      series: [
        {
          name: '产品A',
          type: 'bar',
          data: [120, 132, 101, 134, 90, 230, 210, 132, 101, 134, 90, 230],
          itemStyle: {
            color: '#5470c6'
          },
          emphasis: {
            focus: 'series'
          }
        },
        {
          name: '产品B',
          type: 'bar',
          data: [150, 182, 191, 234, 290, 330, 310, 201, 164, 190, 130, 110],
          itemStyle: {
            color: '#91cc75'
          },
          emphasis: {
            focus: 'series'
          }
        },
        {
          name: '产品C',
          type: 'bar',
          data: [60, 72, 71, 74, 90, 130, 110, 132, 101, 94, 60, 50],
          itemStyle: {
            color: '#fac858'
          },
          emphasis: {
            focus: 'series'
          }
        }
      ]
    };

    // 应用配置项
    myChart.setOption(option);

    // 响应窗口大小变化
    window.addEventListener('resize', function () {
      myChart.resize();
    });

    // 使用setTimeout模拟异步加载数据
    setTimeout(() => {
      // 动态更新图表
      myChart.setOption({
        series: [
          {
            data: [120, 132, 101, 134, 90, 230, 210, 132, 101, 134, 90, 230]
          },
          {
            data: [150, 182, 191, 234, 290, 330, 310, 201, 164, 190, 130, 110]
          },
          {
            data: [60, 72, 71, 74, 90, 130, 110, 132, 101, 94, 60, 50]
          }
        ]
      });
    }, 0);
  </script>
</body>

</html>