<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECharts 5.6.0 Pie Chart Example</title>
  <!-- Load ECharts 5.6.0 from CDN -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.6.0/echarts.min.js"></script> -->
  <script src="../node_modules/echarts/dist/echarts.min.js"></script>
  <style>
    #chart-container {
      width: 440px;
      height: 240px;
      margin: 0 auto;
      border: 1px solid #ccc;
    }

    body {
      background-color: rgb(125, 125, 125);
    }
  </style>
</head>

<body>
  <div id="chart-container"></div>

  <script>
    // 1. Define your original data
    const mySeriesData = [
      { value: 3300, name: '失败' },
      { value: 3111, name: '成功' },
      { value: 2333, name: '待执' },
      { value: 6666, name: '二字' },
      { value: 6616, name: '二字s' },
      { value: 66416, name: '二字5s' },

      { value: 8887, name: '复活' }
    ];

    // 2. Function to calculate total
    function calculatePieTotal(seriesData) {
      let total = 0;
      if (seriesData && Array.isArray(seriesData)) {
        seriesData.forEach(item => {
          total += item.value;
        });
      }
      return total;
    }

    // 3. Calculate total count in advance
    const totalCount = calculatePieTotal(mySeriesData);

    // Initialize chart
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize the chart
      const chartDom = document.getElementById('chart-container');
      const myChart = echarts.init(chartDom);

      // Chart option
      const option = {
        color: ['#D4AF48', '#4188E6', '#51AADD', '#73C7A3', '#4D75CD'],
        tooltip: {
          trigger: 'item',
          formatter: '{b}: {c} ({d}%)'
        },
        legend: {
          orient: 'vertical',
          itemGap: 15,
          itemWidth: 5,  // 设置矩形宽度
          itemHeight: 5, // 设置矩形高度，使其为正方形且大小合适
          top: 'center',
          left: '50%',
          icon: 'rect',
          // formatter: function (name) {
          //   const foundItem = mySeriesData.find(item => item.name === name);
          //   if (foundItem) {
          //     const percentage = totalCount === 0 ? 0 : ((foundItem.value / totalCount) * 100).toFixed(1);
          //     return `${name} ${foundItem.value} ${percentage}%`;
          //   }
          //   return name;
          // },
          formatter: function (name) {
            const foundItem = mySeriesData.find(item => item.name === name);
            if (foundItem) {
              const percentage = totalCount === 0 ? 0 : ((foundItem.value / totalCount) * 100).toFixed(1);
              // 使用 rich text 格式化，通过不同的标签（a, b, c）应用不同样式
              // {a|名称} {b|数值} {c|百分比}
              return `{a|${name}}{b|${foundItem.value}}{c|${percentage}%}`;
            }
            return name;
          },
          textStyle: {
            color: '#ffffff',
            fontSize: 8,
            rich: {
              a: { // 名称的样式
                fontSize: 10,
                color: '#aaa', // 灰色
                width: 50, // 可以设置固定宽度，以帮助对齐，根据实际名称长度调整
                align: 'left' // 名称左对齐
              },
              b: { // 数值的样式
                color: '#ffffff', // 白色
                fontSize: 10,
                width: 50, // 给数值一个固定宽度，帮助对齐
                align: 'left', // 数值右对齐
                padding: [0, 5, 0, 5] // 可选：数值与百分比之间的内边距
              },
              c: { // 百分比的样式
                fontSize: 11,

                color: '#ffffff', // 白色
                width: 40, // 给百分比一个固定宽度，帮助对齐
                align: 'right' // 百分比右对齐
              }
            }
          }

        },
        series: [
          {
            name: '任务完成情况',
            type: 'pie',
            radius: ['60', '70'],
            center: ['30%', '50%'], // 将饼图中心点向左移动，并垂直居中
            avoidLabelOverlap: false,
            padAngle: 2,
            label: {
              show: true,
              position: 'center',
              formatter: () => '{value|' + totalCount + '}\n{text|总数}',
              rich: {
                value: {
                  color: '#ffffff',
                  fontSize: 15,
                  align: 'center',
                  verticalAlign: 'middle'
                },
                text: {
                  color: '#ffffff',
                  fontSize: 8,
                  align: 'center',
                  verticalAlign: 'middle',
                  padding: 5
                }
              }
            },
            emphasis: {
              label: {
                show: true,
                fontSize: 30,
                fontWeight: 'bold'
              }
            },
            labelLine: {
              show: true
            },
            data: mySeriesData
          }
        ]
      };

      // Apply the configuration
      myChart.setOption(option);

      // Handle window resize
      window.addEventListener('resize', function () {
        myChart.resize();
      });
    });
  </script>
</body>

</html>