<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECharts图例SVG背景示例</title>
  <!-- 引入ECharts 5.6.0 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    #chart-container {
      width: 800px;
      height: 500px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .description {
      max-width: 800px;
      margin-bottom: 20px;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="description">
    <h2>ECharts图例SVG背景效果展示</h2>
    <p>此示例使用SVG作为ECharts图例项的背景图片，每个图例项都有独特的SVG背景。</p>
  </div>
  <div id="chart-container"></div>

  <script>
    // 初始化图表
    const chart = echarts.init(document.getElementById('chart-container'));

    // 图例数据
    const legendData = ['产品A', '产品B', '产品C', '产品D', '产品E'];

    // 创建SVG背景图（使用Data URL格式）
    // 每个图例项使用不同颜色和样式的SVG背景
    // 1. 把 SVG 画布宽度改小，留出位移空间
    const createSvgBackground = (fillColor, opacity = 0.3) => {
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="40">
            <!-- 2. rect 整体向左移 20 px（x="-20"） -->
            <rect x="-20" width="100" height="100%" rx="4" ry="4"
                  fill="${fillColor}" fill-opacity="${opacity}" />
            <path d="M-20,20 Q10,0 40,20 T80,20"
                  stroke="${fillColor}" stroke-width="1"
                  fill="none" stroke-opacity="0.5"/>
        </svg>
    `;
      return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
    };

    // 为每个图例项生成不同的SVG背景
    const legendBackgroundSvgs = [
      createSvgBackground('#337ab7'),  // 产品A的SVG背景（蓝色）
      createSvgBackground('#5cb85c'),  // 产品B的SVG背景（绿色）
      createSvgBackground('#f0ad4e'),  // 产品C的SVG背景（黄色）
      createSvgBackground('#d9534f'),  // 产品D的SVG背景（红色）
      createSvgBackground('#5bc0de')   // 产品E的SVG背景（青色）
    ];

    // 生成模拟数据
    const generateData = (name, count) => {
      return Array.from({ length: count }, () => Math.floor(Math.random() * 100));
    };

    // 创建富文本样式配置
    const richStyles = {};
    legendData.forEach((name, index) => {
      richStyles[`bg${index}`] = {
        backgroundColor: {
          image: legendBackgroundSvgs[index]
        },
        padding: [8, 15, 8, 15], // 上下左右内边距
        borderRadius: 4,
        color: '#333',
        fontWeight: 'bold',
        fontSize: 14
      };
    });

    // 图表配置
    const option = {
      title: {
        text: '使用SVG作为背景的图例示例',
        left: 'center'
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        }
      },
      legend: {
        data: legendData,
        top: 50,
        left: 'center',
        // 图例项样式
        itemStyle: {
          borderWidth: 1,
          borderRadius: 3
        },
        // 图例项之间的间距
        itemGap: 15,
        // 使用富文本格式化图例
        textStyle: {
          rich: richStyles
        },
        formatter: function (name) {
          const index = legendData.indexOf(name);
          if (index === -1) return name;
          // 使用富文本标签引用对应的样式
          return `{bg${index}|${name}}`;
        }
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: ['1月', '2月', '3月', '4月', '5月', '6月']
      },
      yAxis: {
        type: 'value'
      },
      series: legendData.map((name, index) => ({
        name: name,
        type: 'bar',
        data: generateData(name, 6),
        itemStyle: {
          color: [`#337ab7`, `#5cb85c`, `#f0ad4e`, `#d9534f`, `#5bc0de`][index]
        }
      }))
    };

    // 设置图表配置
    chart.setOption(option);

    // 响应窗口大小变化
    window.addEventListener('resize', () => {
      chart.resize();
    });
  </script>
</body>

</html>